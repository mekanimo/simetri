<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simetri.geometry.geometry &#8212; simetri.graphics 0.0.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=282f96c0"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for simetri.geometry.geometry</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Geometry related utilities.</span>
<span class="sd">These functions are used to perform geometric operations.</span>
<span class="sd">They are not documented. Some of the are one off functions that</span>
<span class="sd">are not used in the main codebase or tested.&quot;&quot;&quot;</span>

<span class="c1"># To do: Clean up this module and add documentation.</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">hypot</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">acos</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">isclose</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">around</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">simetri.helpers.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">flatten</span><span class="p">,</span>
    <span class="n">lerp</span><span class="p">,</span>
    <span class="n">sanitize_graph_edges</span><span class="p">,</span>
    <span class="n">equal_cycles</span><span class="p">,</span>
    <span class="n">reg_poly_points</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..helpers.vector</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vector2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..graphics.common</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_defaults</span><span class="p">,</span>
    <span class="n">common_properties</span><span class="p">,</span>
    <span class="n">Point</span><span class="p">,</span>
    <span class="n">Line</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">i_vec</span><span class="p">,</span>
    <span class="n">j_vec</span><span class="p">,</span>
    <span class="n">VecType</span><span class="p">,</span>
    <span class="n">axis_x</span><span class="p">,</span>
    <span class="n">axis_y</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..graphics.all_enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">Types</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..settings.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaults</span>

<span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
<span class="n">around</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span>

<span class="n">TWO_PI</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>  <span class="c1"># 360 degrees</span>


<div class="viewcode-block" id="is_number">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_number">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_number</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if x is a number.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (Any): The input value to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if x is a number, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span></div>



<div class="viewcode-block" id="bbox_overlap">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.bbox_overlap">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bbox_overlap</span><span class="p">(</span>
    <span class="n">min_x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">min_y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_y2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">min_x3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">min_y3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_x4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_y4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given two bounding boxes, return True if they overlap.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_x1 (float): Minimum x-coordinate of the first bounding box.</span>
<span class="sd">        min_y1 (float): Minimum y-coordinate of the first bounding box.</span>
<span class="sd">        max_x2 (float): Maximum x-coordinate of the first bounding box.</span>
<span class="sd">        max_y2 (float): Maximum y-coordinate of the first bounding box.</span>
<span class="sd">        min_x3 (float): Minimum x-coordinate of the second bounding box.</span>
<span class="sd">        min_y3 (float): Minimum y-coordinate of the second bounding box.</span>
<span class="sd">        max_x4 (float): Maximum x-coordinate of the second bounding box.</span>
<span class="sd">        max_y4 (float): Maximum y-coordinate of the second bounding box.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the bounding boxes overlap, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="n">max_x2</span> <span class="o">&lt;</span> <span class="n">min_x3</span> <span class="ow">or</span> <span class="n">max_x4</span> <span class="o">&lt;</span> <span class="n">min_x1</span> <span class="ow">or</span> <span class="n">max_y2</span> <span class="o">&lt;</span> <span class="n">min_y3</span> <span class="ow">or</span> <span class="n">max_y4</span> <span class="o">&lt;</span> <span class="n">min_y1</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="sine_wave">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.sine_wave">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sine_wave</span><span class="p">(</span>
    <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">phase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a sine wave.</span>

<span class="sd">    Args:</span>
<span class="sd">        amplitude (float): Amplitude of the wave.</span>
<span class="sd">        frequency (float): Frequency of the wave.</span>
<span class="sd">        duration (float): Duration of the wave.</span>
<span class="sd">        sample_rate (float): Sample rate.</span>
<span class="sd">        phase (float, optional): Phase angle of the wave. Defaults to 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Time and signal arrays representing the sine wave.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">duration</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">frequency</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="c1"># plt.plot(time, signal)</span>
    <span class="c1"># plt.xlabel(&#39;Time (s)&#39;)</span>
    <span class="c1"># plt.ylabel(&#39;Amplitude&#39;)</span>
    <span class="c1"># plt.title(&#39;Discretized Sine Wave&#39;)</span>
    <span class="c1"># plt.grid(True)</span>
    <span class="c1"># plt.show()</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">signal</span></div>



<div class="viewcode-block" id="damping_function">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.damping_function">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">damping_function</span><span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a damping function based on the given amplitude, duration, and sample rate.</span>

<span class="sd">    Args:</span>
<span class="sd">        amplitude (float): The initial amplitude of the damping function.</span>
<span class="sd">        duration (float): The duration over which the damping occurs, in seconds.</span>
<span class="sd">        sample_rate (float): The number of samples per second.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of float values representing the damping function over time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">damping</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">)):</span>
        <span class="n">damping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">amplitude</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">sample_rate</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">damping</span></div>


<div class="viewcode-block" id="sine_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.sine_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sine_points</span><span class="p">(</span>
    <span class="n">period</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">n_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">phase_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">damping</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate sine wave points.</span>

<span class="sd">    Args:</span>
<span class="sd">        amplitude (float): Amplitude of the wave.</span>
<span class="sd">        frequency (float): Frequency of the wave.</span>
<span class="sd">        duration (float): Duration of the wave.</span>
<span class="sd">        sample_rate (float): Sample rate.</span>
<span class="sd">        phase (float, optional): Phase angle of the wave. Defaults to 0.</span>
<span class="sd">        damping (float, optional): Damping coefficient. Defaults to 0.</span>
<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array of points representing the sine wave.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">phase_angle</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">period</span>
    <span class="n">n_cycles</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="n">period</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_points</span> <span class="o">*</span> <span class="n">n_cycles</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">damping</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">damping</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">vertices</span></div>



<div class="viewcode-block" id="circle_inversion">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_inversion">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_inversion</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inverts a point with respect to a circle.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (tuple): The point to invert, represented as a tuple (x, y).</span>
<span class="sd">        center (tuple): The center of the circle, represented as a tuple (x, y).</span>
<span class="sd">        radius (float): The radius of the circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: The inverted point, represented as a tuple (x, y).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">center</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Calculate the distance from the point to the center of the circle</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># If the point is at the center of the circle, return the point at infinity</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="c1"># Calculate the distance from the inverted point to the center of the circle</span>
    <span class="n">inv_dist</span> <span class="o">=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="c1"># Calculate the inverted point</span>
    <span class="n">inv_x</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">inv_dist</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">inv_y</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">inv_dist</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">cy</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="k">return</span> <span class="n">inv_x</span><span class="p">,</span> <span class="n">inv_y</span></div>



<div class="viewcode-block" id="line_segment_bbox">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_segment_bbox">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_segment_bbox</span><span class="p">(</span>
    <span class="n">x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the bounding box of a line segment.</span>

<span class="sd">    Args:</span>
<span class="sd">        x1 (float): Segment start point x-coordinate.</span>
<span class="sd">        y1 (float): Segment start point y-coordinate.</span>
<span class="sd">        x2 (float): Segment end point x-coordinate.</span>
<span class="sd">        y2 (float): Segment end point y-coordinate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Bounding box as (min_x, min_y, max_x, max_y).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span></div>



<div class="viewcode-block" id="line_segment_bbox_check">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_segment_bbox_check">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_segment_bbox_check</span><span class="p">(</span><span class="n">seg1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">seg2</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given two line segments, return True if their bounding boxes overlap.</span>

<span class="sd">    Args:</span>
<span class="sd">        seg1 (Line): First line segment.</span>
<span class="sd">        seg2 (Line): Second line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the bounding boxes overlap, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">seg1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">seg1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">seg2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">seg2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bbox_overlap</span><span class="p">(</span>
        <span class="o">*</span><span class="n">line_segment_bbox</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="o">*</span><span class="n">line_segment_bbox</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="all_close_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.all_close_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">all_close_points</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">with_dist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all close points in a list of points along with their ids.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (Sequence[Sequence]): List of points with ids [[x1, y1, id1], [x2, y2, id2], ...].</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>
<span class="sd">        with_dist (bool, optional): Whether to include distances in the result. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of the form {id1: [id2, id3, ...], ...}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">point_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># points array [[x1, y1, id1], ...]]</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">point_arr</span> <span class="o">=</span> <span class="n">point_arr</span><span class="p">[</span><span class="n">point_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>  <span class="c1"># sort by x values in the</span>
    <span class="c1"># first column</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">point_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">point_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">point_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">point_arr</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># [x, y, id, xmin, xmax]</span>

    <span class="n">i_id</span><span class="p">,</span> <span class="n">i_xmin</span><span class="p">,</span> <span class="n">i_xmax</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>  <span class="c1"># column indices</span>
    <span class="n">d_connections</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">d_connections</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">point_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">sl_xmin</span><span class="p">,</span> <span class="n">sl_xmax</span> <span class="o">=</span> <span class="n">point_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
        <span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">point_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="p">:][</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">point_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmax</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">sl_xmin</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">point_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmin</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sl_xmax</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">cand</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cand</span><span class="p">[</span><span class="n">i_id</span><span class="p">])</span>
            <span class="n">point2</span> <span class="o">=</span> <span class="n">cand</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">point2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
                <span class="n">d_connections</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id2</span><span class="p">)</span>
                <span class="n">d_connections</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">with_dist</span><span class="p">:</span>
                    <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">distance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">point2</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d_connections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">pairs</span></div>



<div class="viewcode-block" id="is_simple">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_simple">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_simple</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if the polygon is simple.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (list): List of points representing the polygon.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the polygon is simple, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[[</span><span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">segment_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
        <span class="n">segment_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segment_coords</span><span class="p">)</span>  <span class="c1"># segments array</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">seg_arr</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">id_</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="n">i_xmin</span><span class="p">,</span> <span class="n">i_ymin</span><span class="p">,</span> <span class="n">i_xmax</span><span class="p">,</span> <span class="n">i_ymax</span><span class="p">,</span> <span class="n">i_id</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>  <span class="c1"># column indices</span>

    <span class="n">s_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># set of processed segment pairs</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">sl_xmin</span><span class="p">,</span> <span class="n">sl_ymin</span><span class="p">,</span> <span class="n">sl_xmax</span><span class="p">,</span> <span class="n">sl_ymax</span><span class="p">,</span> <span class="n">id1</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># keep pushing the sweep line forward</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="p">:][</span>
            <span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmax</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">sl_xmin</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmin</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sl_xmax</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_ymax</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">sl_ymin</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_ymin</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sl_ymax</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">cand</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cand</span><span class="p">[</span><span class="n">i_id</span><span class="p">])</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">s_processed</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">s_processed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            <span class="n">seg2</span> <span class="o">=</span> <span class="n">cand</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">segment</span>
            <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">seg2</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">intersection3</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Connection</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">:</span>
                <span class="n">length1</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
                <span class="n">length2</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">))</span>
                <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">chain_length</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span><span class="n">length1</span> <span class="o">+</span> <span class="n">length2</span><span class="p">,</span> <span class="n">chain_length</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Connection</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">,</span> <span class="n">Connection</span><span class="o">.</span><span class="n">PARALLEL</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="all_intersections">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.all_intersections">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">all_intersections</span><span class="p">(</span>
    <span class="n">segments</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Line</span><span class="p">],</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_intersection3</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all intersection points of the given list of segments</span>
<span class="sd">    (sweep line algorithm variant)</span>

<span class="sd">    Args:</span>
<span class="sd">        segments (Sequence[Line]): List of line segments [[[x1, y1], [x2, y2]], [[x1, y1], [x2, y2]], ...].</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>
<span class="sd">        use_intersection3 (bool, optional): Whether to use intersection3 function. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of the form {segment_id: [[id1, (x1, y1)], [id2, (x2, y2)]], ...}.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">segment_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
        <span class="n">segment_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">segment_coords</span><span class="p">)</span>  <span class="c1"># segments array</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">seg_arr</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">id_</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">seg_arr</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">seg_arr</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    <span class="n">i_xmin</span><span class="p">,</span> <span class="n">i_ymin</span><span class="p">,</span> <span class="n">i_xmax</span><span class="p">,</span> <span class="n">i_ymax</span><span class="p">,</span> <span class="n">i_id</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>  <span class="c1"># column indices</span>
    <span class="c1"># ind1, ind2 are indexes of segments in the list of segments</span>
    <span class="n">d_ind1_x_point_ind2</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {id1: [((x, y), id2), ...], ...}</span>
    <span class="n">d_ind1_conn_type_x_res_ind2</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {id1: [(conn_type, x_res, id2), ...], ...}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_intersection3</span><span class="p">:</span>
            <span class="n">d_ind1_conn_type_x_res_ind2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_ind1_x_point_ind2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x_points</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># intersection points</span>
    <span class="n">s_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># set of processed segment pairs</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">sl_xmin</span><span class="p">,</span> <span class="n">sl_ymin</span><span class="p">,</span> <span class="n">sl_xmax</span><span class="p">,</span> <span class="n">sl_ymax</span><span class="p">,</span> <span class="n">id1</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id1</span><span class="p">)</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># keep pushing the sweep line forward</span>
        <span class="c1"># filter by overlap of the bounding boxes of the segments with the</span>
        <span class="c1"># sweep line&#39;s active segment. If the bounding boxes do not overlap,</span>
        <span class="c1"># the segments cannot intersect. If the bounding boxes overlap,</span>
        <span class="c1"># the segments may intersect.</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="p">:][</span>
            <span class="p">(</span>
                <span class="p">(</span>
                    <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmax</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">sl_xmin</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_xmin</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sl_xmax</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_ymax</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">sl_ymin</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">seg_arr</span><span class="p">[</span><span class="n">start</span><span class="p">:,</span> <span class="n">i_ymin</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sl_ymax</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">cand</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cand</span><span class="p">[</span><span class="n">i_id</span><span class="p">])</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">s_processed</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">s_processed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            <span class="n">seg2</span> <span class="o">=</span> <span class="n">cand</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">use_intersection3</span><span class="p">:</span>
                <span class="c1"># connection type, point/segment</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">intersection3</span><span class="p">(</span><span class="o">*</span><span class="n">segment</span><span class="p">,</span> <span class="o">*</span><span class="n">seg2</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span>
                <span class="n">conn_type</span><span class="p">,</span> <span class="n">x_res</span> <span class="o">=</span> <span class="n">res</span>  <span class="c1"># x_res can be a segment or a point</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># connection type, point</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">intersection2</span><span class="p">(</span><span class="o">*</span><span class="n">segment</span><span class="p">,</span> <span class="o">*</span><span class="n">seg2</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span>
                <span class="n">conn_type</span><span class="p">,</span> <span class="n">x_point</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">if</span> <span class="n">use_intersection3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">conn_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">,</span> <span class="n">Connection</span><span class="o">.</span><span class="n">PARALLEL</span><span class="p">]:</span>
                    <span class="n">d_ind1_conn_type_x_res_ind2</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">conn_type</span><span class="p">,</span> <span class="n">x_res</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span>
                    <span class="n">d_ind1_conn_type_x_res_ind2</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">conn_type</span><span class="p">,</span> <span class="n">x_res</span><span class="p">,</span> <span class="n">id1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">conn_type</span> <span class="o">==</span> <span class="n">Connection</span><span class="o">.</span><span class="n">INTERSECT</span><span class="p">:</span>
                    <span class="n">d_ind1_x_point_ind2</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x_point</span><span class="p">,</span> <span class="n">id2</span><span class="p">))</span>
                    <span class="n">d_ind1_x_point_ind2</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x_point</span><span class="p">,</span> <span class="n">id1</span><span class="p">))</span>
                    <span class="n">x_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">d_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">use_intersection3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d_ind1_conn_type_x_res_ind2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">d_results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">d_results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d_ind1_x_point_ind2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">d_results</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">d_results</span><span class="p">,</span> <span class="n">x_points</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="dot_product2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.dot_product2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dot_product2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dot product of two vectors. AB and BC</span>
<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point, creating vector BA</span>
<span class="sd">        b (Point): Second point, common point for both vectors</span>
<span class="sd">        c (Point): Third point, creating vector BC</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The dot product of vectors BA and BC</span>
<span class="sd">    Note:</span>
<span class="sd">        The function calculates (a-b)·(c-b) which is the dot product of vectors BA and BC.</span>
<span class="sd">        This is useful for finding angles between segments that share a common point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_x</span><span class="p">,</span> <span class="n">a_y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b_x</span><span class="p">,</span> <span class="n">b_y</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">c_x</span><span class="p">,</span> <span class="n">c_y</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b_a_x</span> <span class="o">=</span> <span class="n">a_x</span> <span class="o">-</span> <span class="n">b_x</span>
    <span class="n">b_a_y</span> <span class="o">=</span> <span class="n">a_y</span> <span class="o">-</span> <span class="n">b_y</span>
    <span class="n">b_c_x</span> <span class="o">=</span> <span class="n">c_x</span> <span class="o">-</span> <span class="n">b_x</span>
    <span class="n">b_c_y</span> <span class="o">=</span> <span class="n">c_y</span> <span class="o">-</span> <span class="n">b_y</span>
    <span class="k">return</span> <span class="n">b_a_x</span> <span class="o">*</span> <span class="n">b_c_x</span> <span class="o">+</span> <span class="n">b_a_y</span> <span class="o">*</span> <span class="n">b_c_y</span></div>



<div class="viewcode-block" id="cross_product2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.cross_product2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cross_product2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the cross product of two vectors: BA and BC.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point, creating vector BA</span>
<span class="sd">        b (Point): Second point, common point for both vectors</span>
<span class="sd">        c (Point): Third point, creating vector BC</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The z-component of cross product between vectors BA and BC</span>

<span class="sd">    Note:</span>
<span class="sd">        This gives the signed area of the parallelogram formed by the vectors BA and BC.</span>
<span class="sd">        The sign indicates the orientation (positive for counter-clockwise, negative for clockwise).</span>
<span class="sd">        It is useful for determining the orientation of three points and calculating angles.</span>

<span class="sd">    vec1 = b - a</span>
<span class="sd">    vec2 = c - b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_x</span><span class="p">,</span> <span class="n">a_y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b_x</span><span class="p">,</span> <span class="n">b_y</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">c_x</span><span class="p">,</span> <span class="n">c_y</span> <span class="o">=</span> <span class="n">c</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b_a_x</span> <span class="o">=</span> <span class="n">a_x</span> <span class="o">-</span> <span class="n">b_x</span>
    <span class="n">b_a_y</span> <span class="o">=</span> <span class="n">a_y</span> <span class="o">-</span> <span class="n">b_y</span>
    <span class="n">b_c_x</span> <span class="o">=</span> <span class="n">c_x</span> <span class="o">-</span> <span class="n">b_x</span>
    <span class="n">b_c_y</span> <span class="o">=</span> <span class="n">c_y</span> <span class="o">-</span> <span class="n">b_y</span>
    <span class="k">return</span> <span class="n">b_a_x</span> <span class="o">*</span> <span class="n">b_c_y</span> <span class="o">-</span> <span class="n">b_a_y</span> <span class="o">*</span> <span class="n">b_c_x</span></div>



<div class="viewcode-block" id="angle_between_lines2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.angle_between_lines2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angle_between_lines2</span><span class="p">(</span><span class="n">point1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">point2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">point3</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given line1 as point1 and point2, and line2 as point2 and point3</span>
<span class="sd">    return the angle between two lines</span>
<span class="sd">    (point2 is the corner point)</span>

<span class="sd">    Args:</span>
<span class="sd">        point1 (Point): First point of the first line.</span>
<span class="sd">        point2 (Point): Second point of the first line and first point of the second line.</span>
<span class="sd">        point3 (Point): Second point of the second line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Angle between the two lines in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span>
        <span class="n">cross_product2</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">,</span> <span class="n">point3</span><span class="p">),</span> <span class="n">dot_product2</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">,</span> <span class="n">point3</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="angled_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.angled_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angled_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a line find another line with theta radians between them.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        theta (float): Angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: New line with the given angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># find the angle of the line</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">theta1</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">theta2</span> <span class="o">=</span> <span class="n">theta1</span> <span class="o">+</span> <span class="n">theta</span>
    <span class="c1"># find the length of the line</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">length_</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="c1"># find the new line</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">)]</span></div>



<div class="viewcode-block" id="angled_vector">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.angled_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angled_vector</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a vector with the given angle</span>

<span class="sd">    Args:</span>
<span class="sd">        angle (float): Angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[float]: Vector with the given angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)]</span></div>



<div class="viewcode-block" id="close_points2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.close_points2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">close_points2</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">dist2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if two points are close to each other.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>
<span class="sd">        dist2 (float, optional): Square of the threshold distance. Defaults to 0.01.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the points are close to each other, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">distance2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dist2</span></div>



<div class="viewcode-block" id="close_angles">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.close_angles">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">close_angles</span><span class="p">(</span><span class="n">angle1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">angle2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">angtol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if two angles are close to each other.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle1 (float): First angle in radians.</span>
<span class="sd">        angle2 (float): Second angle in radians.</span>
<span class="sd">        angtol (float, optional): Angle tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the angles are close to each other, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">angtol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">angtol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;angtol&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">angle1</span> <span class="o">-</span> <span class="n">angle2</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">angtol</span></div>



<div class="viewcode-block" id="distance">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the distance between two points.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Distance between the two points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hypot</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="distance2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.distance2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">distance2</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the squared distance between two points.</span>
<span class="sd">    Useful for comparing distances without the need to</span>
<span class="sd">    compute the square root.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Squared distance between the two points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="connect2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.connect2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">connect2</span><span class="p">(</span>
    <span class="n">poly_point1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
    <span class="n">poly_point2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
    <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect two polypoints together.</span>

<span class="sd">    Args:</span>
<span class="sd">        poly_point1 (list[Point]): First list of points.</span>
<span class="sd">        poly_point2 (list[Point]): Second list of points.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: Connected list of points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_tol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">])</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">start1</span><span class="p">,</span> <span class="n">end1</span> <span class="o">=</span> <span class="n">poly_point1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly_point1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">start2</span><span class="p">,</span> <span class="n">end2</span> <span class="o">=</span> <span class="n">poly_point2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly_point2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pp1</span> <span class="o">=</span> <span class="n">poly_point1</span><span class="p">[:]</span>
    <span class="n">pp2</span> <span class="o">=</span> <span class="n">poly_point2</span><span class="p">[:]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">end1</span><span class="p">,</span> <span class="n">start2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp1</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">elif</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">end1</span><span class="p">,</span> <span class="n">end2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp1</span><span class="p">)</span>
        <span class="n">pp2</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">elif</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">start2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">pp1</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp1</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">elif</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">end2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">pp1</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp1</span><span class="p">)</span>
        <span class="n">pp2</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="stitch">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.stitch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stitch</span><span class="p">(</span>
    <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">],</span>
    <span class="n">closed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">return_points</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stitches a list of lines together.</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list[Line]): List of lines to stitch.</span>
<span class="sd">        closed (bool, optional): Whether the lines form a closed shape. Defaults to True.</span>
<span class="sd">        return_points (bool, optional): Whether to return points or lines. Defaults to True.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: Stitched list of points or lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_point</span> <span class="o">=</span> <span class="n">intersect2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_point</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">final_x</span> <span class="o">=</span> <span class="n">intersect2</span><span class="p">(</span>
            <span class="n">x1</span><span class="p">,</span>
            <span class="n">y1</span><span class="p">,</span>
            <span class="n">x2</span><span class="p">,</span>
            <span class="n">y2</span><span class="p">,</span>
            <span class="n">x3</span><span class="p">,</span>
            <span class="n">y3</span><span class="p">,</span>
            <span class="n">x4</span><span class="p">,</span>
            <span class="n">y4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">final_x</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">final_x</span><span class="p">)</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">return_points</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">connected_pairs</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="double_offset_polylines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.double_offset_polylines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">double_offset_polylines</span><span class="p">(</span>
    <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of double offset lines from a list of lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        lines (list[Point]): List of points representing the lines.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to 1.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of double offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">double_offset_lines</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">lines1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="n">lines2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
    <span class="n">lines1</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">lines1</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">lines2</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">lines1</span><span class="p">,</span> <span class="n">lines2</span><span class="p">]</span></div>



<div class="viewcode-block" id="polygon_cg">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polygon_cg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_cg</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of points that define a polygon, return the center point.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Center point of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xnext</span> <span class="o">=</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_points</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ynext</span> <span class="o">=</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_points</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">ynext</span> <span class="o">-</span> <span class="n">xnext</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">cx</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">xnext</span><span class="p">)</span> <span class="o">*</span> <span class="n">temp</span>
        <span class="n">cy</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">ynext</span><span class="p">)</span> <span class="o">*</span> <span class="n">temp</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="n">polygon_area</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">area_</span> <span class="o">*</span> <span class="mi">6</span>
    <span class="k">if</span> <span class="n">denom</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">cx</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="n">cy</span> <span class="o">/</span> <span class="n">denom</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="polygon_center2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polygon_center2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_center2</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of points that define a polygon, return the center point.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon_points (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Center point of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">polygon_points</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span></div>



<div class="viewcode-block" id="polygon_center">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polygon_center">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_center</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of points that define a polygon, return the center point.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon_points (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Center point of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">polygon_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="n">polygon_area</span><span class="p">(</span><span class="n">polygon_points</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">area_</span><span class="p">),</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">area_</span><span class="p">))</span></div>



<div class="viewcode-block" id="offset_polygon">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_polygon">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_polygon</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of offset lines from a list of lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (list[Point]): List of points representing the polygon.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to -1.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:])</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">right_handed</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">,</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">offset_edge</span> <span class="o">=</span> <span class="n">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">-</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_edge</span><span class="p">)</span>

    <span class="n">poly</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poly</span></div>



<div class="viewcode-block" id="double_offset_polygons">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.double_offset_polygons">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">double_offset_polygons</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of double offset lines from a list of lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (list[Point]): List of points representing the polygon.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to 1.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of double offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">right_handed</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">poly1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">,</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">double_offset_lines</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">poly1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="n">poly2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">)</span>
    <span class="n">poly1</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;canvas&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;canvas&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">canvas</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">..graphics.shape</span><span class="w"> </span><span class="kn">import</span> <span class="n">Shape</span>

            <span class="n">closed</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">poly1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">Shape</span><span class="p">(</span><span class="n">poly1</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">closed</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">poly2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">Shape</span><span class="p">(</span><span class="n">poly2</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">poly1</span><span class="p">,</span> <span class="n">poly2</span><span class="p">]</span></div>



<div class="viewcode-block" id="offset_polygon_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_polygon_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_polygon_points</span><span class="p">(</span>
    <span class="n">polygon</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of double offset lines from a list of lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (list[Point]): List of points representing the polygon.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to 1.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of double offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">,</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">offset_edge</span> <span class="o">=</span> <span class="n">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_edge</span><span class="p">)</span>

    <span class="n">poly</span> <span class="o">=</span> <span class="n">stitch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">right_handed</span><span class="p">(</span><span class="n">poly</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">poly</span></div>



<div class="viewcode-block" id="double_offset_lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.double_offset_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">double_offset_lines</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Line</span><span class="p">,</span> <span class="n">Line</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return two offset lines to a given line segment with the given offset amount.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line segment.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[Line, Line]: Two offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="n">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
    <span class="n">line2</span> <span class="o">=</span> <span class="n">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">-</span><span class="n">offset</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span></div>



<div class="viewcode-block" id="equal_lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.equal_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">equal_lines</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">line2</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if two lines are close enough.</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the lines are close enough, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line1</span>
    <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">line2</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">close_points2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">close_points2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="equal_polygons">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.equal_polygons">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">equal_polygons</span><span class="p">(</span>
    <span class="n">poly1</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">poly2</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if two polygons are close enough.</span>

<span class="sd">    Args:</span>
<span class="sd">        poly1 (Sequence[Point]): First polygon.</span>
<span class="sd">        poly2 (Sequence[Point]): Second polygon.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the polygons are close enough, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly2</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poly1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">pnt</span><span class="p">,</span> <span class="n">poly2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="extended_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.extended_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extended_line</span><span class="p">(</span><span class="n">dist</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">extend_both</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a line ((x1, y1), (x2, y2)) and a distance,</span>
<span class="sd">    the given line is extended by distance units.</span>
<span class="sd">    Return a new line ((x1, y1), (x2&#39;, y2&#39;)).</span>

<span class="sd">    Args:</span>
<span class="sd">        dist (float): Distance to extend the line.</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        extend_both (bool, optional): Whether to extend both ends of the line. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Extended line.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="c1"># p = (1-t)*p1 + t*p2 : parametric equation of a line segment (p1, p2)</span>
        <span class="n">line_length</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">line_length</span> <span class="o">+</span> <span class="n">dist</span><span class="p">)</span> <span class="o">/</span> <span class="n">line_length</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">t</span>

        <span class="k">return</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">x2</span><span class="p">,</span> <span class="n">c</span> <span class="o">*</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">y2</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">extend_both</span><span class="p">:</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">extend</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">extend</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="p">[</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">extend</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="line_through_point_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_through_point_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_through_point_angle</span><span class="p">(</span>
    <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">length_</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">both_sides</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a line that passes through the given point</span>
<span class="sd">    with the given angle and length.</span>
<span class="sd">    If both_side is True, the line is extended on both sides by the given</span>
<span class="sd">    length.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Point through which the line passes.</span>
<span class="sd">        angle (float): Angle of the line in radians.</span>
<span class="sd">        length_ (float): Length of the line.</span>
<span class="sd">        both_sides (bool, optional): Whether to extend the line on both sides. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Line passing through the given point with the given angle and length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">line</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">both_sides</span><span class="p">:</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">extended_line</span><span class="p">(</span><span class="n">length_</span><span class="p">,</span> <span class="p">[</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">line</span></div>



<div class="viewcode-block" id="remove_duplicate_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.remove_duplicate_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicate_points</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">dist_tol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of points with duplicate points removed.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points with duplicate points removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">new_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">new_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
                <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_points</span></div>



<div class="viewcode-block" id="remove_collinear_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.remove_collinear_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_collinear_points</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of points with collinear points removed.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points with collinear points removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">new_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">collinear</span><span class="p">(</span>
                <span class="n">new_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)],</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span>
            <span class="p">):</span>
                <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_points</span></div>



<div class="viewcode-block" id="fix_degen_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.fix_degen_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fix_degen_points</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
    <span class="n">loop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">area_rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">area_atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">check_collinear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of points with duplicate points removed.</span>
<span class="sd">    Remove the middle point from the collinear points.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points.</span>
<span class="sd">        loop (bool, optional): Whether to loop the points. Defaults to False.</span>
<span class="sd">        closed (bool, optional): Whether the points form a closed shape. Defaults to False.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>
<span class="sd">        area_rtol (float, optional): Relative tolerance for area. Defaults to None.</span>
<span class="sd">        area_atol (float, optional): Absolute tolerance for area. Defaults to None.</span>
<span class="sd">        check_collinear (bool, optional): Whether to check for collinear points. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points with duplicate and collinear points removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">new_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">new_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
                <span class="n">new_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">loop</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">new_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
            <span class="n">new_points</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check_collinear</span><span class="p">:</span>
        <span class="c1"># Check for collinear points and remove the middle one.</span>
        <span class="n">new_points</span> <span class="o">=</span> <span class="n">merge_consecutive_collinear_edges</span><span class="p">(</span>
            <span class="n">new_points</span><span class="p">,</span> <span class="n">closed</span><span class="p">,</span> <span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">new_points</span></div>



<div class="viewcode-block" id="clockwise">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.clockwise">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">clockwise</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return 1 if the points p, q, and r are in clockwise order,</span>
<span class="sd">    return -1 if the points are in counter-clockwise order,</span>
<span class="sd">    return 0 if the points are collinear</span>

<span class="sd">    Args:</span>
<span class="sd">        p (Point): First point.</span>
<span class="sd">        q (Point): Second point.</span>
<span class="sd">        r (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: 1 if the points are in clockwise order, -1 if counter-clockwise, 0 if collinear.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="n">area</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">area_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">area_</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="intersects">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersects">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="n">seg1</span><span class="p">,</span> <span class="n">seg2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the line segments intersect.</span>
<span class="sd">    If they are chained together, they are considered as intersecting.</span>
<span class="sd">    Returns True if the segments intersect, False otherwise.</span>

<span class="sd">    Args:</span>
<span class="sd">        seg1 (Line): First line segment.</span>
<span class="sd">        seg2 (Line): Second line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the segments intersect, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="n">seg1</span>
    <span class="n">p2</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">seg2</span>
    <span class="n">o1</span> <span class="o">=</span> <span class="n">clockwise</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">o2</span> <span class="o">=</span> <span class="n">clockwise</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
    <span class="n">o3</span> <span class="o">=</span> <span class="n">clockwise</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
    <span class="n">o4</span> <span class="o">=</span> <span class="n">clockwise</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">o1</span> <span class="o">!=</span> <span class="n">o2</span> <span class="ow">and</span> <span class="n">o3</span> <span class="o">!=</span> <span class="n">o4</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">o1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">between</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">q1</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">o2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">between</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q1</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">o3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">between</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">o4</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">between</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="is_chained">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_chained">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_chained</span><span class="p">(</span><span class="n">seg1</span><span class="p">,</span> <span class="n">seg2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if the line segments are chained together.</span>

<span class="sd">    Args:</span>
<span class="sd">        seg1 (Line): First line segment.</span>
<span class="sd">        seg2 (Line): Second line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the segments are chained together, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="n">seg1</span>
    <span class="n">p2</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">seg2</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">close_points2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="ow">or</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="direction">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.direction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">direction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks the orientation of three points (p, q, r).</span>

<span class="sd">    Args:</span>
<span class="sd">        p (Point): First point.</span>
<span class="sd">        q (Point): Second point.</span>
<span class="sd">        r (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: 0 if collinear, &gt;0 if counter-clockwise, &lt;0 if clockwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="collinear_segments">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.collinear_segments">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">collinear_segments</span><span class="p">(</span><span class="n">segment1</span><span class="p">,</span> <span class="n">segment2</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if two line segments (a1, b1) and (a2, b2) are collinear.</span>

<span class="sd">    Args:</span>
<span class="sd">        segment1 (Line): First line segment.</span>
<span class="sd">        segment2 (Line): Second line segment.</span>
<span class="sd">        tol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the segments are collinear, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;tol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">tol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">segment1</span>
    <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">segment2</span>

    <span class="k">return</span> <span class="n">isclose</span><span class="p">(</span><span class="n">direction</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">a2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isclose</span><span class="p">(</span>
        <span class="n">direction</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">atol</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="global_to_local">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.global_to_local">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">global_to_local</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">yi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a point(x, y) in global coordinates</span>
<span class="sd">    and local CS position and orientation,</span>
<span class="sd">    return a point(ksi, eta) in local coordinates</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): Global x-coordinate.</span>
<span class="sd">        y (float): Global y-coordinate.</span>
<span class="sd">        xi (float): Local x-coordinate.</span>
<span class="sd">        yi (float): Local y-coordinate.</span>
<span class="sd">        theta (float, optional): Angle in radians. Defaults to 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Local coordinates (ksi, eta).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sin_theta</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">cos_theta</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">ksi</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos_theta</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">yi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_theta</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">yi</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos_theta</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin_theta</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ksi</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span></div>



<div class="viewcode-block" id="stitch_lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.stitch_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stitch_lines</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">line2</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Line</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;if the lines intersect, trim the lines</span>
<span class="sd">    if the lines don&#39;t intersect, extend the lines</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[Line]: Trimmed or extended lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">intersection_</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">intersection_</span><span class="p">:</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">line1</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line2</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">intersection_</span><span class="p">]</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="p">[</span><span class="n">intersection_</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="get_quadrant">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.get_quadrant">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_quadrant</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;quadrants:</span>
<span class="sd">    +x, +y = 1st</span>
<span class="sd">    +x, -y = 2nd</span>
<span class="sd">    -x, -y = 3rd</span>
<span class="sd">    +x, -y = 4th</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): x-coordinate.</span>
<span class="sd">        y (float): y-coordinate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Quadrant number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">((</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">TWO_PI</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_quadrant_from_deg_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.get_quadrant_from_deg_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_quadrant_from_deg_angle</span><span class="p">(</span><span class="n">deg_angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;quadrants:</span>
<span class="sd">    (0, 90) = 1st</span>
<span class="sd">    (90, 180) = 2nd</span>
<span class="sd">    (180, 270) = 3rd</span>
<span class="sd">    (270, 360) = 4th</span>

<span class="sd">    Args:</span>
<span class="sd">        deg_angle (float): Angle in degrees.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Quadrant number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">deg_angle</span> <span class="o">/</span> <span class="mf">90.0</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="homogenize">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.homogenize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">homogenize</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of points to homogeneous coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (Sequence[Point]): List of points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Homogeneous coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">xy_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">xy_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">xy_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">n_cols</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">xy_array</span> <span class="o">=</span> <span class="n">xy_array</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">homogeneous_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_array</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">homogeneous_array</span></div>




<span class="k">def</span><span class="w"> </span><span class="nf">_homogenize</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Internal use only. API provides a homogenize function.</span>
<span class="sd">    Given a sequence of coordinates(x1, y1, x2, y2, ... xn, yn),</span>
<span class="sd">    return a numpy array of points array(((x1, y1, 1.),</span>
<span class="sd">    (x2, y2, 1.), ... (xn, yn, 1.))).</span>

<span class="sd">    Args:</span>
<span class="sd">        coordinates (Sequence[float]): Sequence of coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Homogeneous coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xy_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">xy_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">homogeneous_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_array</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">homogeneous_array</span>


<div class="viewcode-block" id="intersect2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersect2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersect2</span><span class="p">(</span>
    <span class="n">x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the intersection point of two lines.</span>
<span class="sd">    line1: (x1, y1), (x2, y2)</span>
<span class="sd">    line2: (x3, y3), (x4, y4)</span>
<span class="sd">    To find the intersection point of two line segments use the</span>
<span class="sd">    &quot;intersection&quot; function</span>

<span class="sd">    Args:</span>
<span class="sd">        x1 (float): x-coordinate of the first point of the first line.</span>
<span class="sd">        y1 (float): y-coordinate of the first point of the first line.</span>
<span class="sd">        x2 (float): x-coordinate of the second point of the first line.</span>
<span class="sd">        y2 (float): y-coordinate of the second point of the first line.</span>
<span class="sd">        x3 (float): x-coordinate of the first point of the second line.</span>
<span class="sd">        y3 (float): y-coordinate of the first point of the second line.</span>
<span class="sd">        x4 (float): x-coordinate of the second point of the second line.</span>
<span class="sd">        y4 (float): y-coordinate of the second point of the second line.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Intersection point of the two lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">x1_x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span>
    <span class="n">y1_y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span>
    <span class="n">x3_x4</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">-</span> <span class="n">x4</span>
    <span class="n">y3_y4</span> <span class="o">=</span> <span class="n">y3</span> <span class="o">-</span> <span class="n">y4</span>

    <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1_x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3_y4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1_y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3_x4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># parallel lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3_x4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x1_x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">*</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span> <span class="o">*</span> <span class="n">x4</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3_y4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y1_y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x3</span> <span class="o">*</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span> <span class="o">*</span> <span class="n">x4</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="intersect">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersect">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersect</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">line2</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the intersection point of two lines.</span>
<span class="sd">    line1: [(x1, y1), (x2, y2)]</span>
<span class="sd">    line2: [(x3, y3), (x4, y4)]</span>
<span class="sd">    To find the intersection point of two line segments use the</span>
<span class="sd">    &quot;intersection&quot; function</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Intersection point of the two lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">intersect2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span></div>



<div class="viewcode-block" id="intersection2">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersection2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersection2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the intersection of two line segments. See the documentation</span>

<span class="sd">    Args:</span>
<span class="sd">        x1 (float): x-coordinate of the first point of the first line segment.</span>
<span class="sd">        y1 (float): y-coordinate of the first point of the first line segment.</span>
<span class="sd">        x2 (float): x-coordinate of the second point of the first line segment.</span>
<span class="sd">        y2 (float): y-coordinate of the second point of the first line segment.</span>
<span class="sd">        x3 (float): x-coordinate of the first point of the second line segment.</span>
<span class="sd">        y3 (float): y-coordinate of the first point of the second line segment.</span>
<span class="sd">        x4 (float): x-coordinate of the second point of the second line segment.</span>
<span class="sd">        y4 (float): y-coordinate of the second point of the second line segment.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Connection type and intersection point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">x2_x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">y2_y1</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">x4_x3</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span> <span class="n">x3</span>
    <span class="n">y4_y3</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">y4_y3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2_x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x4_x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2_y1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">):</span>  <span class="c1"># parallel</span>
        <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">PARALLEL</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">x1_x3</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x3</span>
    <span class="n">y1_y3</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y3</span>
    <span class="n">ua</span> <span class="o">=</span> <span class="p">((</span><span class="n">x4_x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1_y3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y4_y3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1_x3</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">if</span> <span class="n">ua</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ua</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2_x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1_y3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2_y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1_x3</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">if</span> <span class="n">ub</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ub</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2_x1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ua</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2_y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">INTERSECT</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="intersection3">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersection3">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersection3</span><span class="p">(</span>
    <span class="n">x1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">x4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y4</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">area_atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Connection</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the intersection of two line segments. See the documentation</span>
<span class="sd">    for more details.</span>

<span class="sd">    Args:</span>
<span class="sd">        x1 (float): x-coordinate of the first point of the first line segment.</span>
<span class="sd">        y1 (float): y-coordinate of the first point of the first line segment.</span>
<span class="sd">        x2 (float): x-coordinate of the second point of the first line segment.</span>
<span class="sd">        y2 (float): y-coordinate of the second point of the first line segment.</span>
<span class="sd">        x3 (float): x-coordinate of the first point of the second line segment.</span>
<span class="sd">        y3 (float): y-coordinate of the first point of the second line segment.</span>
<span class="sd">        x4 (float): x-coordinate of the second point of the second line segment.</span>
<span class="sd">        y4 (float): y-coordinate of the second point of the second line segment.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>
<span class="sd">        area_atol (float, optional): Absolute tolerance for area. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Connection type and intersection result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># collinear check uses area_atol</span>

    <span class="c1"># s1: start1 = (x1, y1)</span>
    <span class="c1"># e1: end1 = (x2, y2)</span>
    <span class="c1"># s2: start2 = (x3, y3)</span>
    <span class="c1"># e2: end2 = (x4, y4)</span>
    <span class="c1"># s1s2: start1 and start2 is connected</span>
    <span class="c1"># s1e2: start1 and end2 is connected</span>
    <span class="c1"># e1s2: end1 and start2 is connected</span>
    <span class="c1"># e1e2: end1 and end2 is connected</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_tol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_atol</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
    <span class="n">segment1</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]</span>
    <span class="n">segment2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)]</span>

    <span class="c1"># check if the segments&#39; bounding boxes overlap</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line_segment_bbox_check</span><span class="p">(</span><span class="n">segment1</span><span class="p">,</span> <span class="n">segment2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Check if the segments are parallel</span>
    <span class="n">x2_x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">y2_y1</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">x4_x3</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">-</span> <span class="n">x3</span>
    <span class="n">y4_y3</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span> <span class="n">y3</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span><span class="n">y4_y3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2_x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x4_x3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2_y1</span><span class="p">)</span>
    <span class="n">parallel</span> <span class="o">=</span> <span class="n">isclose</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
    <span class="c1"># angle1 = atan2(y2 - y1, x2 - x1) % pi</span>
    <span class="c1"># angle2 = atan2(y4 - y3, x4 - x3) % pi</span>
    <span class="c1"># parallel = close_angles(angle1, angle2, angtol=defaults[&#39;angtol&#39;])</span>

    <span class="c1"># Coincident end points</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">s1s2</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="n">s1e2</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="n">e1s2</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="n">e1e2</span> <span class="o">=</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">)</span>
    <span class="n">connected</span> <span class="o">=</span> <span class="n">s1s2</span> <span class="ow">or</span> <span class="n">s1e2</span> <span class="ow">or</span> <span class="n">e1s2</span> <span class="ow">or</span> <span class="n">e1e2</span>
    <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
        <span class="n">length1</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
        <span class="n">length2</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="p">(</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">))</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">)</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">)</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
        <span class="n">total_length</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">),</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">))</span>
        <span class="n">l1_eq_l2</span> <span class="o">=</span> <span class="n">isclose</span><span class="p">(</span><span class="n">length1</span><span class="p">,</span> <span class="n">length2</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
        <span class="n">l1_eq_total</span> <span class="o">=</span> <span class="n">isclose</span><span class="p">(</span><span class="n">length1</span><span class="p">,</span> <span class="n">total_length</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
        <span class="n">l2_eq_total</span> <span class="o">=</span> <span class="n">isclose</span><span class="p">(</span><span class="n">length2</span><span class="p">,</span> <span class="n">total_length</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">connected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">l1_eq_l2</span> <span class="ow">and</span> <span class="n">l1_eq_total</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CONGRUENT</span><span class="p">,</span> <span class="n">segment1</span>

            <span class="k">if</span> <span class="n">l1_eq_total</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CONTAINS</span><span class="p">,</span> <span class="n">segment1</span>
            <span class="k">if</span> <span class="n">l2_eq_total</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">WITHIN</span><span class="p">,</span> <span class="n">segment2</span>
            <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">length1</span> <span class="o">+</span> <span class="n">length2</span><span class="p">,</span> <span class="n">total_length</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">):</span>
                <span class="c1"># chained and collienar</span>
                <span class="k">if</span> <span class="n">s1s2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s1e2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e1s2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">e1e2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total_length</span> <span class="o">&lt;</span> <span class="n">length1</span> <span class="o">+</span> <span class="n">length2</span> <span class="ow">and</span> <span class="n">collinear_segments</span><span class="p">(</span>
                <span class="n">segment1</span><span class="p">,</span> <span class="n">segment2</span><span class="p">,</span> <span class="n">atol</span>
            <span class="p">):</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">)</span>
                <span class="n">seg</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">OVERLAPS</span><span class="p">,</span> <span class="n">seg</span>

            <span class="k">return</span> <span class="n">intersection2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s1s2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s1e2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e1s2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e1e2</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">,</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">YJOINT</span><span class="p">,</span> <span class="n">e1</span>
            <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">YJOINT</span><span class="p">,</span> <span class="n">s1</span>
            <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">YJOINT</span><span class="p">,</span> <span class="n">e2</span>
            <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Connection</span><span class="o">.</span><span class="n">YJOINT</span><span class="p">,</span> <span class="n">s2</span>

            <span class="k">return</span> <span class="n">intersection2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Connection</span><span class="o">.</span><span class="n">DISJOINT</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>



<div class="viewcode-block" id="merge_consecutive_collinear_edges">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.merge_consecutive_collinear_edges">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_consecutive_collinear_edges</span><span class="p">(</span>
    <span class="n">points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">area_rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">area_atol</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the middle points from collinear edges.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points.</span>
<span class="sd">        closed (bool, optional): Whether the points form a closed shape. Defaults to False.</span>
<span class="sd">        area_rtol (float, optional): Relative tolerance for area. Defaults to None.</span>
<span class="sd">        area_atol (float, optional): Absolute tolerance for area. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points with collinear points removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;area_rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">cyc</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
        <span class="n">looping</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">discarded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">collinear</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">area_rtol</span><span class="o">=</span><span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span><span class="o">=</span><span class="n">area_atol</span><span class="p">):</span>
                <span class="n">discarded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">looping</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">discarded</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">looping</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="intersection">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.intersection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">intersection</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">line2</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return the intersection point of two line segments.</span>
<span class="sd">    segment1: ((x1, y1), (x2, y2))</span>
<span class="sd">    segment2: ((x3, y3), (x4, y4))</span>
<span class="sd">    if line segments do not intersect return -1</span>
<span class="sd">    if line segments are parallel return 0</span>
<span class="sd">    if line segments are connected (share a point) return 1</span>
<span class="sd">    To find the intersection point of two lines use the &quot;intersect&quot; function</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line segment.</span>
<span class="sd">        line2 (Line): Second line segment.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Intersection type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rtol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rtol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">intersection2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span></div>



<div class="viewcode-block" id="merge_segments">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.merge_segments">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_segments</span><span class="p">(</span><span class="n">seg1</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">seg2</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge two segments into one segment if they are connected.</span>
<span class="sd">    They need to be overlapping or simply connected to each other,</span>
<span class="sd">    otherwise they will not be merged. Order doesn&#39;t matter.</span>

<span class="sd">    Args:</span>
<span class="sd">        seg1 (Sequence[Point]): First segment.</span>
<span class="sd">        seg2 (Sequence[Point]): Second segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[Point]: Merged segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Conn</span> <span class="o">=</span> <span class="n">Connection</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">seg1</span>
    <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">seg2</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">all_intersections</span><span class="p">([(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)],</span> <span class="n">use_intersection3</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">conn_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conn_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Conn</span><span class="o">.</span><span class="n">OVERLAPS</span><span class="p">,</span> <span class="n">Conn</span><span class="o">.</span><span class="n">CONGRUENT</span><span class="p">,</span> <span class="n">Conn</span><span class="o">.</span><span class="n">CHAIN</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">verts</span>
        <span class="k">elif</span> <span class="n">conn_type</span> <span class="o">==</span> <span class="n">Conn</span><span class="o">.</span><span class="n">COLL_CHAIN</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># need this to avoid returning an empty dict</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="invert">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.invert">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">invert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inverts p about a circle at the given center and radius</span>

<span class="sd">    Args:</span>
<span class="sd">        p (Point): Point to invert.</span>
<span class="sd">        center (Point): Center of the circle.</span>
<span class="sd">        radius (float): Radius of the circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Inverted point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span></div>

    <span class="c1"># return radius**2 * (p - center) / dist</span>


<div class="viewcode-block" id="is_horizontal">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_horizontal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_horizontal</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the line is horizontal.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        eps (float, optional): Tolerance. Defaults to 0.0001.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the line is horizontal, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">j_vec</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">line_vector</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="n">eps</span></div>



<div class="viewcode-block" id="is_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_line</span><span class="p">(</span><span class="n">line_</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the input is a line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line_ (Any): Input value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the input is a line, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line_</span>
        <span class="k">return</span> <span class="n">is_point</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_point</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="is_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_point</span><span class="p">(</span><span class="n">pnt</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the input is a point.</span>

<span class="sd">    Args:</span>
<span class="sd">        pnt (Any): Input value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the input is a point, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pnt</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">is_number</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_number</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="is_vertical">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_vertical">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_vertical</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the line is vertical.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        eps (float, optional): Tolerance. Defaults to 0.0001.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the line is vertical, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i_vec</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">line_vector</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span> <span class="o">&lt;=</span> <span class="n">eps</span></div>



<div class="viewcode-block" id="length">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.length">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the length of a line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Length of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">return</span> <span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></div>



<div class="viewcode-block" id="lerp_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.lerp_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lerp_point</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear interpolation of two points.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>
<span class="sd">        t (float): Interpolation parameter. t = 0 =&gt; p1, t = 1 =&gt; p2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Interpolated point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">lerp</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">lerp</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span></div>



<div class="viewcode-block" id="slope">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.slope">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">slope</span><span class="p">(</span><span class="n">start_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the slope of a line given by two points.</span>
<span class="sd">    Order makes a difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_point (Point): Start point of the line.</span>
<span class="sd">        end_point (Point): End point of the line.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Slope of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start_point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end_point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">isclose</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;INF&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="segmentize_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.segmentize_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">segmentize_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">segment_length</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of points that would form segments with the given length.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        segment_length (float): Length of each segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Line]: List of segments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length_</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">increments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length_</span> <span class="o">/</span> <span class="n">segment_length</span><span class="p">)</span>
    <span class="n">x_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">increments</span><span class="p">)</span>
    <span class="n">y_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">increments</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_segments</span><span class="p">,</span> <span class="n">y_segments</span><span class="p">))</span></div>



<div class="viewcode-block" id="line_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_angle</span><span class="p">(</span><span class="n">start_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the orientation angle (in radians) of a line given by start and end points.</span>
<span class="sd">    Order makes a difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_point (Point): Start point of the line.</span>
<span class="sd">        end_point (Point): End point of the line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Orientation angle of the line in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="n">end_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<div class="viewcode-block" id="inclination_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.inclination_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">inclination_angle</span><span class="p">(</span><span class="n">start_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the inclination angle (in radians) of a line given by start and end points.</span>
<span class="sd">    Inclination angle is always between zero and pi.</span>
<span class="sd">    Order makes no difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_point (Point): Start point of the line.</span>
<span class="sd">        end_point (Point): End point of the line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Inclination angle of the line in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">line_angle</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span> <span class="o">%</span> <span class="n">pi</span></div>



<div class="viewcode-block" id="line2vector">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line2vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line2vector</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the vector representation of a line</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Vector representation of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">]</span></div>



<div class="viewcode-block" id="line_through_point_and_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_through_point_and_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_through_point_and_angle</span><span class="p">(</span>
    <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">length_</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a line through the given point with the given angle and length</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Point through which the line passes.</span>
<span class="sd">        angle (float): Angle of the line in radians.</span>
<span class="sd">        length_ (float, optional): Length of the line. Defaults to 100.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Line passing through the given point with the given angle and length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]]</span></div>



<div class="viewcode-block" id="line_vector">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_vector</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the vector representation of a line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Vector representation of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Vector2D</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span></div>



<div class="viewcode-block" id="mid_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.mid_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mid_point</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the mid point of two points.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Mid point of the two points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="norm">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.norm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">:</span> <span class="n">VecType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the norm (vector length) of a vector.</span>

<span class="sd">    Args:</span>
<span class="sd">        vec (VecType): Input vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Norm of the vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hypot</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="ndarray_to_xy_list">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.ndarray_to_xy_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ndarray_to_xy_list</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a numpy array to a list of points.</span>

<span class="sd">    Args:</span>
<span class="sd">        arr (np.ndarray): Input numpy array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[Point]: List of points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>



<div class="viewcode-block" id="offset_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an offset line from a given line.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Sequence[Point]): Input line.</span>
<span class="sd">        offset (float): Offset distance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[Point]: Offset line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_vec</span> <span class="o">=</span> <span class="n">perp_unit_vector</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">offset</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">offset</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span><span class="p">],</span> <span class="p">[</span><span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]]</span></div>



<div class="viewcode-block" id="offset_lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_lines</span><span class="p">(</span><span class="n">polylines</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Line</span><span class="p">],</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of offset lines from a list of lines.</span>

<span class="sd">    Args:</span>
<span class="sd">        polylines (Sequence[Line]): List of input lines.</span>
<span class="sd">        offset (float, optional): Offset distance. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Line]: List of offset lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stitch_</span><span class="p">(</span><span class="n">polyline</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">polyline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polyline</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">polyline</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">line2</span> <span class="o">=</span> <span class="n">polyline</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">stitch_lines</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
            <span class="n">line1</span> <span class="o">=</span> <span class="n">line2</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="n">poly</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">polylines</span><span class="p">:</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">stitch_</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poly</span></div>



<div class="viewcode-block" id="normalize">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.normalize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span><span class="n">vec</span><span class="p">:</span> <span class="n">VecType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the normalized vector.</span>

<span class="sd">    Args:</span>
<span class="sd">        vec (VecType): Input vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Normalized vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm_</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">,</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">]</span></div>



<div class="viewcode-block" id="offset_point_on_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_point_on_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_point_on_line</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a point on a line that is offset from the given point.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        offset (float): Offset distance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Offset point on the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="c1"># normalize the vector</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">mag</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">mag</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">offset</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">offset</span></div>



<div class="viewcode-block" id="offset_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_point</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an offset point from a given point.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        dx (float, optional): Offset distance in x-direction. Defaults to 0.</span>
<span class="sd">        dy (float, optional): Offset distance in y-direction. Defaults to 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Offset point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span></div>



<div class="viewcode-block" id="parallel_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.parallel_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parallel_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a parallel line to the given line that goes through the given point</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        point (Point): Point through which the parallel line passes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Parallel line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">],</span> <span class="p">[</span><span class="n">x3</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y3</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]]</span></div>



<div class="viewcode-block" id="perp_offset_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.perp_offset_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">perp_offset_point</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a point that is offset from the given point in the perpendicular direction to the given line.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        offset (float): Offset distance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Perpendicular offset point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unit_vec</span> <span class="o">=</span> <span class="n">perp_unit_vector</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">offset</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">offset</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]</span></div>



<div class="viewcode-block" id="perp_unit_vector">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.perp_unit_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">perp_unit_vector</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the perpendicular unit vector to a line</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Perpendicular unit vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">norm_</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="n">dy</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">]</span></div>



<div class="viewcode-block" id="point_on_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_on_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_on_line</span><span class="p">(</span>
    <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the given point is on the given line</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the point is on the line, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">return</span> <span class="n">isclose</span><span class="p">(</span><span class="n">slope</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">point</span><span class="p">),</span> <span class="n">slope</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span></div>



<div class="viewcode-block" id="point_on_line_segment">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_on_line_segment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_on_line_segment</span><span class="p">(</span>
    <span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the given point is on the given line segment</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line segment.</span>
<span class="sd">        rtol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the point is on the line segment, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">return</span> <span class="n">isclose</span><span class="p">(</span>
        <span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span> <span class="o">+</span> <span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">point</span><span class="p">)),</span>
        <span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span>
        <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span>
        <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="point_to_line_distance">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_to_line_distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_to_line_distance</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the vector from a point to a line</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Distance from the point to the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">((</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span><span class="p">))</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="point_to_line_seg_distance">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_to_line_seg_distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_to_line_seg_distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lp1</span><span class="p">,</span> <span class="n">lp2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a point p and a line segment defined by boundary points</span>
<span class="sd">    lp1 and lp2, returns the distance between the line segment and the point.</span>
<span class="sd">    If the point is not located in the perpendicular area between the</span>
<span class="sd">    boundary points, returns False.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (Point): Input point.</span>
<span class="sd">        lp1 (Point): First boundary point of the line segment.</span>
<span class="sd">        lp2 (Point): Second boundary point of the line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Distance between the point and the line segment, or False if the point is not in the perpendicular area.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lp1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">lp2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error! Line is ill defined. Start and end points are coincident.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">lp1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">lp2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">/</span> <span class="n">distance</span><span class="p">(</span><span class="n">lp1</span><span class="p">,</span> <span class="n">lp2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">distance</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># p is not between lp1 and lp2</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="point_to_line_vec">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_to_line_vec">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_to_line_vec</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the perpendicular vector from a point to a line</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        unit (bool, optional): Whether to return a unit vector. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Perpendicular vector from the point to the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">norm_</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">unit_vec</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">dy</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">unit_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">unit_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist</span><span class="p">,</span> <span class="n">unit_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dist</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="polygon_area">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polygon_area">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_area</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">dist_tol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the area of a polygon.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (Sequence[Point]): List of points representing the polygon.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Area of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:])</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">point</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">area_</span> <span class="o">+=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span>
    <span class="k">return</span> <span class="n">area_</span> <span class="o">/</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="polyline_length">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polyline_length">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polyline_length</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dist_tol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the perimeter of a polygon.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (Sequence[Point]): List of points representing the polygon.</span>
<span class="sd">        closed (bool, optional): Whether the polygon is closed. Defaults to False.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Perimeter of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[:]</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">perimeter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">perimeter</span> <span class="o">+=</span> <span class="n">distance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">perimeter</span></div>



<div class="viewcode-block" id="right_handed">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.right_handed">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">right_handed</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">dist_tol</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If polygon is counter-clockwise, return True</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (Sequence[Point]): List of points representing the polygon.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the polygon is counter-clockwise, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">added_point</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">added_point</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">point</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">area_</span> <span class="o">+=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span>
    <span class="k">if</span> <span class="n">added_point</span><span class="p">:</span>
        <span class="n">polygon</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">area_</span> <span class="o">&gt;</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="radius2side_len">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.radius2side_len">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">radius2side_len</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a radius and the number of sides, return the side length</span>
<span class="sd">    of an n-sided regular polygon with the given radius</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of sides.</span>
<span class="sd">        radius (float): Radius of the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Side length of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span></div>



<div class="viewcode-block" id="tokenize_svg_path">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.tokenize_svg_path">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tokenize_svg_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tokenize an SVG path string.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): SVG path string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: List of tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-zA-Z]|[-+]?\d*\.\d+|\d+&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>



<div class="viewcode-block" id="law_of_cosines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.law_of_cosines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">law_of_cosines</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the angle of a triangle given the three sides.</span>
<span class="sd">    Returns the angle of A in radians. A is the angle between</span>
<span class="sd">    sides b and c.</span>
<span class="sd">    cos(A) = (b^2 + c^2 - a^2) / (2 * b * c)</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Length of side a.</span>
<span class="sd">        b (float): Length of side b.</span>
<span class="sd">        c (float): Length of side c.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Angle of A in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">acos</span><span class="p">((</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">))</span></div>



<div class="viewcode-block" id="segmentize_catmull_rom">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.segmentize_catmull_rom">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">segmentize_catmull_rom</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a and b are the control points and c and d are</span>
<span class="sd">    start and end points respectively,</span>
<span class="sd">    n is the number of segments to generate.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): First control point.</span>
<span class="sd">        b (float): Second control point.</span>
<span class="sd">        c (float): Start point.</span>
<span class="sd">        d (float): End point.</span>
<span class="sd">        n (int, optional): Number of segments to generate. Defaults to 100.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[float]: List of points representing the segments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span>
    <span class="n">term3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">d</span>
    <span class="n">term4</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">term4</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="side_len_to_radius">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.side_len_to_radius">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">side_len_to_radius</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">side_len</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a side length and the number of sides, return the radius</span>
<span class="sd">    of an n-sided regular polygon with the given side_len length</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of sides.</span>
<span class="sd">        side_len (float): Side length of the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Radius of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">side_len</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span></div>



<div class="viewcode-block" id="translate_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.translate_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">translate_line</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a translated line by dx and dy</span>

<span class="sd">    Args:</span>
<span class="sd">        dx (float): Translation distance in x-direction.</span>
<span class="sd">        dy (float): Translation distance in y-direction.</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Translated line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span><span class="p">],</span> <span class="p">[</span><span class="n">x2</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">dy</span><span class="p">]]</span></div>



<div class="viewcode-block" id="trim_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.trim_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trim_line</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">line2</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trim line1 to the intersection of line1 and line2.</span>
<span class="sd">    Extend it if necessary.</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Trimmed line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">intersection_</span> <span class="o">=</span> <span class="n">intersection</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">intersection_</span><span class="p">]</span></div>



<div class="viewcode-block" id="unit_vector">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.unit_vector">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vector</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the unit vector of a line</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Unit vector of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm_</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">,</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">]</span></div>



<div class="viewcode-block" id="unit_vector_">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.unit_vector_">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unit_vector_</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">VecType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the cartesian unit vector of a line</span>
<span class="sd">    with the given line&#39;s start and end points</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[VecType]: Cartesian unit vector of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">norm_</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dx</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">norm_</span><span class="p">]</span></div>



<div class="viewcode-block" id="vec_along_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.vec_along_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vec_along_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a vector along a line with the given magnitude.</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Input line.</span>
<span class="sd">        magnitude (float): Magnitude of the vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Vector along the line with the given magnitude.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="n">axis_x</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">magnitude</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="n">axis_y</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magnitude</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># line is (p1, p2)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">line_angle</span><span class="p">(</span><span class="o">*</span><span class="n">line</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">magnitude</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span></div>



<div class="viewcode-block" id="vec_dir_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.vec_dir_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vec_dir_angle</span><span class="p">(</span><span class="n">vec</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the direction angle of a vector</span>

<span class="sd">    Args:</span>
<span class="sd">        vec (Sequence[float]): Input vector.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Direction angle of the vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<div class="viewcode-block" id="cross_product_sense">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.cross_product_sense">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cross_product_sense</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the cross product sense of vectors a and b.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point.</span>
<span class="sd">        b (Point): Second point.</span>
<span class="sd">        c (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Cross product sense.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length_</span> <span class="o">=</span> <span class="n">cross_product2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">length_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<span class="c1">#      A</span>
<span class="c1">#      /</span>
<span class="c1">#     /</span>
<span class="c1">#   B/</span>
<span class="c1">#    \</span>
<span class="c1">#     \</span>
<span class="c1">#      \</span>
<span class="c1">#       C</span>


<div class="viewcode-block" id="right_turn">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.right_turn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">right_turn</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if p1, p2, p3 make a right turn.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>
<span class="sd">        p3 (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the points make a right turn, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cross</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="left_turn">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.left_turn">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">left_turn</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if p1, p2, p3 make a left turn.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>
<span class="sd">        p3 (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the points make a left turn, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cross</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="cross">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.cross">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cross</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the cross product of vectors p1p2 and p1p3.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point.</span>
<span class="sd">        p2 (Point): Second point.</span>
<span class="sd">        p3 (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Cross product of the vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span></div>



<div class="viewcode-block" id="tri_to_cart">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.tri_to_cart">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tri_to_cart</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of points from triangular to cartesian coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points in triangular coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: List of points in cartesian coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">@</span> <span class="n">convert</span></div>



<div class="viewcode-block" id="cart_to_tri">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.cart_to_tri">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cart_to_tri</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of points from cartesian to triangular coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points in cartesian coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: List of points in triangular coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">@</span> <span class="n">convert</span></div>



<div class="viewcode-block" id="convex_hull">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.convex_hull">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convex_hull</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the convex hull of a set of 2D points.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of 2D points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: Convex hull of the points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># From http://en.wikibooks.org/wiki/Algorithm__implementation/Geometry/</span>
    <span class="c1"># Convex_hull/Monotone_chain</span>
    <span class="c1"># Sort points lexicographically (tuples are compared lexicographically).</span>
    <span class="c1"># Remove duplicates to detect the case we have just one unique point.</span>
    <span class="n">points</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
    <span class="c1"># Boring case: no points or a single point, possibly repeated multiple times.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="c1"># 2D cross product of OA and OB vectors, i.e. z-component of their 3D cross</span>
    <span class="c1"># product.</span>
    <span class="c1"># Return a positive value, if OAB makes a counter-clockwise turn,</span>
    <span class="c1"># negative for clockwise turn, and zero if the points are collinear.</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cross_</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Build lower hull</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cross_</span><span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">lower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lower</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># Build upper hull</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cross_</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">upper</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># Concatenation of the lower and upper hulls gives the convex hull.</span>
    <span class="c1"># Last point of each list is omitted because it is repeated at the beginning</span>
    <span class="c1"># of the other list.</span>
    <span class="k">return</span> <span class="n">lower</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">upper</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="connected_pairs">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.connected_pairs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">connected_pairs</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of connected pair tuples corresponding to the items.</span>
<span class="sd">    [a, b, c] -&gt; [(a, b), (b, c)]</span>

<span class="sd">    Args:</span>
<span class="sd">        items (list): List of items.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[tuple]: List of connected pair tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span></div>



<div class="viewcode-block" id="flat_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.flat_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">flat_points</span><span class="p">(</span><span class="n">connected_segments</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of points from a list of connected pairs of points.</span>

<span class="sd">    Args:</span>
<span class="sd">        connected_segments (list[tuple]): List of connected pairs of points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">connected_segments</span><span class="p">]</span>
    <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connected_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="point_in_quad">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_in_quad">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_in_quad</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">quad</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the point is inside the quad.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        quad (list[Point]): List of points representing the quad.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the point is inside the quad, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">quad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">quad</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span> <span class="o">=</span> <span class="n">quad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">y4</span><span class="p">]</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">min_x</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">max_x</span> <span class="ow">and</span> <span class="n">min_y</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">max_y</span></div>



<div class="viewcode-block" id="get_polygons">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.get_polygons">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_polygons</span><span class="p">(</span>
    <span class="n">nested_points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">n_round_digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert points to clean polygons. Points are vertices of polygons.</span>

<span class="sd">    Args:</span>
<span class="sd">        nested_points (Sequence[Point]): List of nested points.</span>
<span class="sd">        n_round_digits (int, optional): Number of decimal places to round to. Defaults to 2.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of clean polygons.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dist_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">]</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">..graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cycles</span>

    <span class="n">nested_rounded_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">nested_points</span><span class="p">:</span>
        <span class="n">rounded_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">rounded_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">around</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">n_round_digits</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">rounded_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rounded_point</span><span class="p">))</span>
        <span class="n">nested_rounded_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rounded_points</span><span class="p">)</span>

    <span class="n">s_points</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">d_id__point</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d_point__id</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">nested_rounded_points</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">s_points</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fs_point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s_points</span><span class="p">):</span>
        <span class="n">d_id__point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_point</span>  <span class="c1"># we need a bidirectional dictionary</span>
        <span class="n">d_point__id</span><span class="p">[</span><span class="n">fs_point</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">nested_point_ids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">nested_rounded_points</span><span class="p">:</span>
        <span class="n">point_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">point_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d_point__id</span><span class="p">[</span><span class="n">point</span><span class="p">])</span>
        <span class="n">nested_point_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_ids</span><span class="p">)</span>

    <span class="n">graph_edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">point_ids</span> <span class="ow">in</span> <span class="n">nested_point_ids</span><span class="p">:</span>
        <span class="n">graph_edges</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">connected_pairs</span><span class="p">(</span><span class="n">point_ids</span><span class="p">))</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">graph_edges</span> <span class="o">=</span> <span class="n">sanitize_graph_edges</span><span class="p">(</span><span class="n">graph_edges</span><span class="p">)</span>
    <span class="n">cycles</span> <span class="o">=</span> <span class="n">get_cycles</span><span class="p">(</span><span class="n">graph_edges</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cycles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cycle_</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">cycle_</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">d_id__point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">fix_degen_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dist_tol</span><span class="o">=</span><span class="n">dist_tol</span><span class="p">)</span>
        <span class="n">polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">polygons</span></div>



<div class="viewcode-block" id="offset_point_from_start">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.offset_point_from_start">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">offset_point_from_start</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;p1, p2: points on a line</span>
<span class="sd">    offset: distance from p1</span>
<span class="sd">    return the point on the line at the given offset</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First point on the line.</span>
<span class="sd">        p2 (Point): Second point on the line.</span>
<span class="sd">        offset (float): Distance from p1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Point on the line at the given offset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">p1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="angle_between_two_lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.angle_between_two_lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">angle_between_two_lines</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the angle between two lines in radians.</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Angle between the two lines in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha1</span> <span class="o">=</span> <span class="n">line_angle</span><span class="p">(</span><span class="o">*</span><span class="n">line1</span><span class="p">)</span>
    <span class="n">alpha2</span> <span class="o">=</span> <span class="n">line_angle</span><span class="p">(</span><span class="o">*</span><span class="n">line2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">alpha1</span> <span class="o">-</span> <span class="n">alpha2</span><span class="p">)</span></div>



<div class="viewcode-block" id="rotate_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.rotate_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotate_point</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate a point around a center by an angle in radians.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Point to rotate.</span>
<span class="sd">        center (Point): Center of rotation.</span>
<span class="sd">        angle (float): Angle of rotation in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Rotated point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">center</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">cx</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">cy</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="circle_tangent_to2lines">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_tangent_to2lines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_tangent_to2lines</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">intersection_</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given two lines, their intersection point and a radius,</span>
<span class="sd">    return the center of the circle tangent to both lines and</span>
<span class="sd">    with the given radius.</span>

<span class="sd">    Args:</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>
<span class="sd">        intersection_ (Point): Intersection point of the lines.</span>
<span class="sd">        radius (float): Radius of the circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Center of the circle, start and end points of the tangent lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">angle_between_two_lines</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">offset_point_from_start</span><span class="p">(</span><span class="n">intersection_</span><span class="p">,</span> <span class="n">line1</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">rotate_point</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">intersection_</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">offset_point_from_start</span><span class="p">(</span><span class="n">intersection_</span><span class="p">,</span> <span class="n">line2</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span></div>



<div class="viewcode-block" id="triangle_area">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.triangle_area">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">triangle_area</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given side lengths a, b and c, return the area of the triangle.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Length of side a.</span>
<span class="sd">        b (float): Length of side b.</span>
<span class="sd">        c (float): Length of side c.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Area of the triangle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="p">(</span><span class="n">a_b</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">a_b</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">4</span></div>



<div class="viewcode-block" id="round_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.round_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">round_point</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">n_digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round a point (x, y) to a given precision.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (list[float]): Input point.</span>
<span class="sd">        n_digits (int, optional): Number of decimal places to round to. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[float]: Rounded point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_digits</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n_digits</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="round_segment">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.round_segment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">round_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span> <span class="n">n_digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Round a segment to a given precision.</span>

<span class="sd">    Args:</span>
<span class="sd">        segment (Sequence[Point]): Input segment.</span>
<span class="sd">        n_digits (int, optional): Number of decimal places to round to. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sequence[Point]: Rounded segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">round_point</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_digits</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">round_point</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_digits</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_polygon_grid_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.get_polygon_grid_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_polygon_grid_point</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">circumradius</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;See chapter ??? for explanation of this function.</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of sides.</span>
<span class="sd">        line1 (Line): First line.</span>
<span class="sd">        line2 (Line): Second line.</span>
<span class="sd">        circumradius (float, optional): Circumradius of the polygon. Defaults to 100.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Grid point of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">circumradius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># side length</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">reg_poly_points</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">p4</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">intersection</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="congruent_polygons">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.congruent_polygons">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">congruent_polygons</span><span class="p">(</span>
    <span class="n">polygon1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
    <span class="n">polygon2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">],</span>
    <span class="n">dist_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">area_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">side_length_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">angle_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if two polygons are congruent.</span>
<span class="sd">    They can be translated, rotated and/or reflected.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon1 (list[Point]): First polygon.</span>
<span class="sd">        polygon2 (list[Point]): Second polygon.</span>
<span class="sd">        dist_tol (float, optional): Distance tolerance. Defaults to None.</span>
<span class="sd">        area_tol (float, optional): Area tolerance. Defaults to None.</span>
<span class="sd">        side_length_tol (float, optional): Side length tolerance. Defaults to None.</span>
<span class="sd">        angle_tol (float, optional): Angle tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the polygons are congruent, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_tol</span><span class="p">,</span> <span class="n">angle_tol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;dist_tol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;angle_rtol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">dist_tol</span><span class="p">,</span> <span class="n">area_tol</span><span class="p">,</span> <span class="n">angle_tol</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">side_length_tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">side_length_tol</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">]</span>
    <span class="n">dist_tol2</span> <span class="o">=</span> <span class="n">dist_tol</span> <span class="o">*</span> <span class="n">dist_tol</span>
    <span class="n">poly1</span> <span class="o">=</span> <span class="n">polygon1</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="n">polygon2</span>
    <span class="k">if</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">poly1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">poly1</span> <span class="o">=</span> <span class="n">poly1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">close_points2</span><span class="p">(</span><span class="n">poly2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">poly2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist2</span><span class="o">=</span><span class="n">dist_tol2</span><span class="p">):</span>
        <span class="n">poly2</span> <span class="o">=</span> <span class="n">poly2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">len_poly1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span>
    <span class="n">len_poly2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">len_poly1</span> <span class="o">!=</span> <span class="n">len_poly2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isclose</span><span class="p">(</span>
        <span class="nb">abs</span><span class="p">(</span><span class="n">polygon_area</span><span class="p">(</span><span class="n">poly1</span><span class="p">)),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">polygon_area</span><span class="p">(</span><span class="n">poly2</span><span class="p">)),</span> <span class="n">rtol</span><span class="o">=</span><span class="n">area_tol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">area_tol</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">side_lengths1</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance</span><span class="p">(</span><span class="n">poly1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly1</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_poly1</span><span class="p">)]</span>
    <span class="n">side_lengths2</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance</span><span class="p">(</span><span class="n">poly2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly2</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_poly2</span><span class="p">)]</span>
    <span class="n">check1</span> <span class="o">=</span> <span class="n">equal_cycles</span><span class="p">(</span><span class="n">side_lengths1</span><span class="p">,</span> <span class="n">side_lengths2</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">side_length_tol</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">check1</span><span class="p">:</span>
        <span class="n">check_reverse</span> <span class="o">=</span> <span class="n">equal_cycles</span><span class="p">(</span>
            <span class="n">side_lengths1</span><span class="p">,</span> <span class="n">side_lengths2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="n">side_length_tol</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">check1</span> <span class="ow">or</span> <span class="n">check_reverse</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">angles1</span> <span class="o">=</span> <span class="n">polygon_internal_angles</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span>
    <span class="n">angles2</span> <span class="o">=</span> <span class="n">polygon_internal_angles</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
    <span class="n">check1</span> <span class="o">=</span> <span class="n">equal_cycles</span><span class="p">(</span><span class="n">angles1</span><span class="p">,</span> <span class="n">angles2</span><span class="p">,</span> <span class="n">angle_tol</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">check1</span><span class="p">:</span>
        <span class="n">poly2</span> <span class="o">=</span> <span class="n">poly2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">angles2</span> <span class="o">=</span> <span class="n">polygon_internal_angles</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
        <span class="n">check_reverse</span> <span class="o">=</span> <span class="n">equal_cycles</span><span class="p">(</span><span class="n">angles1</span><span class="p">,</span> <span class="n">angles2</span><span class="p">,</span> <span class="n">angle_tol</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">check1</span> <span class="ow">or</span> <span class="n">check_reverse</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="positive_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.positive_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">positive_angle</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">radians</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the positive angle in radians or degrees.</span>

<span class="sd">    Args:</span>
<span class="sd">        angle (float): Input angle.</span>
<span class="sd">        radians (bool, optional): Whether the angle is in radians. Defaults to True.</span>
<span class="sd">        tol (float, optional): Relative tolerance. Defaults to None.</span>
<span class="sd">        atol (float, optional): Absolute tolerance. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Positive angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tol</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">([</span><span class="s2">&quot;tol&quot;</span><span class="p">,</span> <span class="s2">&quot;rtol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">tol</span><span class="p">,</span> <span class="n">atol</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">radians</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
        <span class="c1"># if isclose(angle, TWO_PI, rtol=tol, atol=atol):</span>
        <span class="c1">#     angle = 0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">+=</span> <span class="mi">360</span>
        <span class="c1"># if isclose(angle, 360, rtol=tol, atol=atol):</span>
        <span class="c1">#     angle = 0</span>
    <span class="k">return</span> <span class="n">angle</span></div>



<div class="viewcode-block" id="polygon_internal_angles">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polygon_internal_angles">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon_internal_angles</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the internal angles of a polygon.</span>

<span class="sd">    Args:</span>
<span class="sd">        polygon (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[float]: List of internal angles of the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">len_polygon</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pnt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">pnt</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">len_polygon</span><span class="p">]</span>
        <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle_between_lines2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">angles</span></div>



<div class="viewcode-block" id="bisector_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.bisector_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bisector_line</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given three points that form two lines [a, b] and [b, c]</span>
<span class="sd">    return the bisector line between them.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point.</span>
<span class="sd">        b (Point): Second point.</span>
<span class="sd">        c (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Bisector line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">mid_point</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span></div>



<div class="viewcode-block" id="between">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.between">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">between</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if c is between a and b.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point.</span>
<span class="sd">        b (Point): Second point.</span>
<span class="sd">        c (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if c is between a and b, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">collinear</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="ow">or</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">or</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="collinear">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.collinear">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">collinear</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">area_rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">area_atol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if a, b, and c are collinear.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point.</span>
<span class="sd">        b (Point): Second point.</span>
<span class="sd">        c (Point): Third point.</span>
<span class="sd">        area_rtol (float, optional): Relative tolerance for area. Defaults to None.</span>
<span class="sd">        area_atol (float, optional): Absolute tolerance for area. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the points are collinear, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span> <span class="o">=</span> <span class="n">get_defaults</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;area_rtol&quot;</span><span class="p">,</span> <span class="s2">&quot;area_atol&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">area_rtol</span><span class="p">,</span> <span class="n">area_atol</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">isclose</span><span class="p">(</span><span class="n">area</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">area_rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">area_atol</span><span class="p">)</span></div>



<div class="viewcode-block" id="polar_to_cartesian">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.polar_to_cartesian">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">polar_to_cartesian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert polar coordinates to cartesian coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        r (float): Radius.</span>
<span class="sd">        theta (float): Angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Cartesian coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span></div>



<div class="viewcode-block" id="cartesian_to_polar">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.cartesian_to_polar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cartesian_to_polar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert cartesian coordinates to polar coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): x-coordinate.</span>
<span class="sd">        y (float): y-coordinate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Polar coordinates (r, theta).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">hypot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">positive_angle</span><span class="p">(</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span></div>



<div class="viewcode-block" id="fillet">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.fillet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fillet</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Line</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given three points that form two lines [a, b] and [b, c]</span>
<span class="sd">    return the clipped lines [a, d], [e, c], center point</span>
<span class="sd">    of the radius circle (tangent to both lines), and the arc</span>
<span class="sd">    angle of the formed fillet.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First point.</span>
<span class="sd">        b (Point): Second point.</span>
<span class="sd">        c (Point): Third point.</span>
<span class="sd">        radius (float): Radius of the fillet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Clipped lines [a, d], [e, c], center point of the radius circle, and the arc angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha2</span> <span class="o">=</span> <span class="n">angle_between_lines2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">sin_alpha2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha2</span><span class="p">)</span>
    <span class="n">cos_alpha2</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha2</span><span class="p">)</span>
    <span class="n">clip_length</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">cos_alpha2</span> <span class="o">/</span> <span class="n">sin_alpha2</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">offset_point_from_start</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">clip_length</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">offset_point_from_start</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">clip_length</span><span class="p">)</span>
    <span class="n">mp</span> <span class="o">=</span> <span class="n">mid_point</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>  <span class="c1"># [b, mp] is the bisector line</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">offset_point_from_start</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">radius</span> <span class="o">/</span> <span class="n">sin_alpha2</span><span class="p">)</span>
    <span class="n">arc_angle</span> <span class="o">=</span> <span class="n">angle_between_lines2</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">],</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">center</span><span class="p">,</span> <span class="n">arc_angle</span></div>



<div class="viewcode-block" id="line_by_point_angle_length">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.line_by_point_angle_length">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">line_by_point_angle_length</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">length_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a point, an angle, and a length, return the line</span>
<span class="sd">    that starts at the point and has the given angle and length.</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Start point of the line.</span>
<span class="sd">        angle (float): Angle of the line in radians.</span>
<span class="sd">        length_ (float): Length of the line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Line with the given angle and length.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)]</span></div>



<div class="viewcode-block" id="surface_normal">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.surface_normal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">surface_normal</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p3</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VecType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the surface normal of a triangle given its vertices.</span>

<span class="sd">    Args:</span>
<span class="sd">        p1 (Point): First vertex.</span>
<span class="sd">        p2 (Point): Second vertex.</span>
<span class="sd">        p3 (Point): Third vertex.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Surface normal vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
    <span class="c1"># Create two vectors from the vertices</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="n">v1</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">-</span> <span class="n">v1</span>

    <span class="c1"># Calculate the cross product of the two vectors</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="c1"># Normalize the vector to get a unit normal vector</span>
    <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">normal</span></div>



<div class="viewcode-block" id="normal">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.normal">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">normal</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the normal vector of a line.</span>

<span class="sd">    Args:</span>
<span class="sd">        point1 (Point): First point of the line.</span>
<span class="sd">        point2 (Point): Second point of the line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        VecType: Normal vector of the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">point1</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">point2</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="n">dy</span> <span class="o">/</span> <span class="n">norm</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">norm</span><span class="p">]</span></div>



<div class="viewcode-block" id="area">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.area">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">area</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the area of a triangle given its vertices.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (Point): First vertex.</span>
<span class="sd">        b (Point): Second vertex.</span>
<span class="sd">        c (Point): Third vertex.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Area of the triangle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="calc_area">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.calc_area">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_area</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the area of a simple polygon (given by a list of its vertices).</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Area of the polygon and whether it is clockwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">area_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">vnext</span> <span class="o">=</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_points</span><span class="p">]</span>
        <span class="n">area_</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vnext</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vnext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">clockwise</span> <span class="o">=</span> <span class="n">area_</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">area_</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">clockwise</span><span class="p">)</span></div>



<div class="viewcode-block" id="remove_bad_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.remove_bad_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_bad_points</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove redundant and collinear points from a list of points.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of points with redundant and collinear points removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-16</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="c1"># check for redundant points</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">[:]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">points</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>  <span class="c1"># then remove the redundant point</span>
                <span class="c1"># maybe we should display a warning message here indicating</span>
                <span class="c1"># that redundant point is removed!!!</span>
                <span class="n">points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="c1"># check for three consecutive points on a line</span>
    <span class="n">lin_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">EPSILON</span> <span class="o">&gt;</span> <span class="n">calc_area</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">EPSILON</span><span class="p">:</span>
            <span class="n">lin_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">EPSILON</span> <span class="o">&gt;</span> <span class="n">calc_area</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">EPSILON</span><span class="p">:</span>
        <span class="n">lin_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lin_points</span><span class="p">:</span>
        <span class="c1"># maybe we should display a warning message here indicating that linear</span>
        <span class="c1"># point is removed!!!</span>
        <span class="n">points</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="is_convex">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.is_convex">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_convex</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the polygon is convex.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Point]): List of points representing the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the polygon is convex, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">remove_bad_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">n_checks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">points</span> <span class="o">+</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">senses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_checks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_checks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">senses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_product_sense</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">senses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cross_product_sense</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">senses</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="set_vertices">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.set_vertices">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_vertices</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the next and previous vertices of a list of vertices.</span>

<span class="sd">    Args:</span>
<span class="sd">        points (list[Vertex]): List of vertices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Vertex</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">Vertex</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">[:])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">cross_product_sense</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">)</span></div>



<div class="viewcode-block" id="circle_circle_intersections">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_circle_intersections">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_circle_intersections</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the intersection points of two circles.</span>

<span class="sd">    Args:</span>
<span class="sd">        x0 (float): x-coordinate of the center of the first circle.</span>
<span class="sd">        y0 (float): y-coordinate of the center of the first circle.</span>
<span class="sd">        r0 (float): Radius of the first circle.</span>
<span class="sd">        x1 (float): x-coordinate of the center of the second circle.</span>
<span class="sd">        y1 (float): y-coordinate of the center of the second circle.</span>
<span class="sd">        r1 (float): Radius of the second circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Intersection points of the two circles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># taken from https://stackoverflow.com/questions/55816902/finding-the-</span>
    <span class="c1"># intersection-of-two-circles</span>
    <span class="c1"># circle 1: (x0, y0), radius r0</span>
    <span class="c1"># circle 2: (x1, y1), radius r1</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># non intersecting</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">r1</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># One circle within other</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># coincident circles</span>
    <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r0</span> <span class="o">==</span> <span class="n">r1</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">r0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="n">x4</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="circle_segment_intersection">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_segment_intersection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_segment_intersection</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the circle and the line segment intersect.</span>

<span class="sd">    Args:</span>
<span class="sd">        circle (Circle): Input circle.</span>
<span class="sd">        p1 (Point): First point of the line segment.</span>
<span class="sd">        p2 (Point): Second point of the line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the circle and the line segment intersect, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if line seg and circle intersects returns true, false otherwise</span>
    <span class="c1"># c: circle</span>
    <span class="c1"># p1 and p2 are the endpoints of the line segment</span>

    <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">circle</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">circle</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">circle</span><span class="o">.</span><span class="n">radius</span>
        <span class="ow">or</span> <span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">circle</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">circle</span><span class="o">.</span><span class="n">radius</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">((</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distance</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">circle</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">circle</span><span class="o">.</span><span class="n">radius</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">res</span>  <span class="c1"># p is not between lp1 and lp2</span></div>



<div class="viewcode-block" id="r_polar">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.r_polar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">r_polar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the radius (distance between the center and the intersection point)</span>
<span class="sd">    of the ellipse at the given angle.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        theta (float): Angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Radius of the ellipse at the given angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">b</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="ellipse_line_intersection">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.ellipse_line_intersection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ellipse_line_intersection</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the intersection points of an ellipse and a line segment</span>
<span class="sd">    connecting the given point to the ellipse center at (0, 0).</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        point (Point): Point on the line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: Intersection points of the ellipse and the line segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># adapted from http://mathworld.wolfram.com/Ellipse-LineIntersection.html</span>
    <span class="c1"># a, b is the ellipse width/2 and height/2 and (x_0, y_0) is the point</span>

    <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span> <span class="o">=</span> <span class="n">point</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">x_0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">y_0</span>

    <span class="k">return</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">)]</span></div>



<div class="viewcode-block" id="ellipse_tangent">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.ellipse_tangent">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ellipse_tangent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the slope of the tangent line to an ellipse at the point (x, y).</span>
<span class="sd">    If point is not on the ellipse, return False.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        x (float): x-coordinate of the point.</span>
<span class="sd">        y (float): y-coordinate of the point.</span>
<span class="sd">        tol (float, optional): Tolerance. Defaults to 0.001.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Slope of the tangent line, or False if the point is not on the ellipse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="elliptic_arclength">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.elliptic_arclength">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">elliptic_arclength</span><span class="p">(</span><span class="n">t_0</span><span class="p">,</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the arclength of an ellipse between the given parametric angles.</span>
<span class="sd">    The ellipse has semi-major axis a and semi-minor axis b.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_0 (float): Start parametric angle in radians.</span>
<span class="sd">        t_1 (float): End parametric angle in radians.</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Arclength of the ellipse between the given parametric angles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># from: https://www.johndcook.com/blog/2022/11/02/elliptic-arc-length/</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">ellipeinc</span> <span class="c1"># this takes too long to import!!!</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">ellipeinc</span><span class="p">(</span><span class="n">t_1</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pi</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">ellipeinc</span><span class="p">(</span><span class="n">t_0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">pi</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span></div>



<div class="viewcode-block" id="central_to_parametric_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.central_to_parametric_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">central_to_parametric_angle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a central angle to a parametric angle on an ellipse.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        phi (float): Central angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Parametric angle in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">((</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>

    <span class="k">return</span> <span class="n">t</span></div>



<div class="viewcode-block" id="parametric_to_central_angle">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.parametric_to_central_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parametric_to_central_angle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a parametric angle on an ellipse to a central angle.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        t (float): Parametric angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Central angle in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">((</span><span class="n">b</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>

    <span class="k">return</span> <span class="n">phi</span></div>



<div class="viewcode-block" id="ellipse_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.ellipse_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ellipse_points</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate points on an ellipse.</span>

<span class="sd">    Args:</span>
<span class="sd">        center (tuple): (x, y) coordinates of the ellipse center.</span>
<span class="sd">        a (float): Length of the semi-major axis.</span>
<span class="sd">        b (float): Length of the semi-minor axis.</span>
<span class="sd">        n_points (int): Number of points to generate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array of (x, y) coordinates of the ellipse points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>



<div class="viewcode-block" id="ellipse_point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.ellipse_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ellipse_point</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a point on an ellipse with the given a=width/2, b=height/2, and angle.</span>

<span class="sd">    Args:</span>
<span class="sd">        a (float): Semi-major axis of the ellipse.</span>
<span class="sd">        b (float): Semi-minor axis of the ellipse.</span>
<span class="sd">        angle (float): Angle in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Point: Point on the ellipse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r_polar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span></div>



<div class="viewcode-block" id="circle_line_intersection">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_line_intersection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_line_intersection</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the intersection points of a circle and a line segment.</span>

<span class="sd">    Args:</span>
<span class="sd">        c (Circle): Input circle.</span>
<span class="sd">        p1 (Point): First point of the line segment.</span>
<span class="sd">        p2 (Point): Second point of the line segment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Intersection points of the circle and the line segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># adapted from http://mathworld.wolfram.com/Circle-LineIntersection.html</span>
    <span class="c1"># c is the circle and p1 and p2 are the line points</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sgn</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">radius</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">pos</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">x1</span> <span class="o">-=</span> <span class="n">x</span>
    <span class="n">x2</span> <span class="o">-=</span> <span class="n">x</span>
    <span class="n">y1</span> <span class="o">-=</span> <span class="n">y</span>
    <span class="n">y2</span> <span class="o">-=</span> <span class="n">y</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">dr2</span> <span class="o">=</span> <span class="n">dr</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">discriminant</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">dr2</span> <span class="o">-</span> <span class="n">d2</span>

    <span class="k">if</span> <span class="n">discriminant</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ddy</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">ddx</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">sqrterm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span> <span class="o">*</span> <span class="n">dr2</span> <span class="o">-</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">sqrterm</span>

        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddy</span> <span class="o">+</span> <span class="n">temp</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ddx</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrterm</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
        <span class="k">if</span> <span class="n">discriminant</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">ddy</span> <span class="o">-</span> <span class="n">temp</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ddx</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrterm</span><span class="p">)</span> <span class="o">/</span> <span class="n">dr2</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="circle_poly_intersection">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_poly_intersection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_poly_intersection</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">polygon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the circle and the polygon intersect.</span>

<span class="sd">    Args:</span>
<span class="sd">        circle (Circle): Input circle.</span>
<span class="sd">        polygon (Polygon): Input polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the circle and the polygon intersect, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">polygon</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">circle_segment_intersection</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="point_to_circle_distance">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.point_to_circle_distance">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">point_to_circle_distance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a point, center point, and radius, returns distance</span>
<span class="sd">    between the given point and the circle</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Point): Input point.</span>
<span class="sd">        center (Point): Center of the circle.</span>
<span class="sd">        radius (float): Radius of the circle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Distance between the point and the circle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_interior_points">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.get_interior_points">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_interior_points</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">n_points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given start and end points and number of interior points</span>
<span class="sd">    returns the positions of the interior points</span>

<span class="sd">    Args:</span>
<span class="sd">        start (Point): Start point.</span>
<span class="sd">        end (Point): End point.</span>
<span class="sd">        n_points (int): Number of interior points.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[Point]: List of interior points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">line_angle</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">length_</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">seg_length</span> <span class="o">=</span> <span class="n">length_</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_points</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_points</span><span class="p">):</span>
        <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">rotate_point</span><span class="p">([</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">seg_length</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">start</span><span class="p">,</span> <span class="n">rot_angle</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">points</span></div>



<div class="viewcode-block" id="circle_3point">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.circle_3point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">circle_3point</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">,</span> <span class="n">point3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given three points, returns the center point and radius</span>

<span class="sd">    Args:</span>
<span class="sd">        point1 (Point): First point.</span>
<span class="sd">        point2 (Point): Second point.</span>
<span class="sd">        point3 (Point): Third point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Center point and radius of the circle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">point1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">point2</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">point3</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">bx</span> <span class="o">-</span> <span class="n">ax</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">by</span> <span class="o">-</span> <span class="n">ay</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">ax</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">ay</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">bx</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">ay</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">ax</span> <span class="o">+</span> <span class="n">cx</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">ay</span> <span class="o">+</span> <span class="n">cy</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">cy</span> <span class="o">-</span> <span class="n">by</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Points are collinear!&quot;</span><span class="p">)</span>

    <span class="n">px</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">f</span><span class="p">))</span> <span class="o">/</span> <span class="n">g</span>
    <span class="n">py</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">e</span><span class="p">))</span> <span class="o">/</span> <span class="n">g</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">ax</span> <span class="o">-</span> <span class="n">px</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ay</span> <span class="o">-</span> <span class="n">py</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span></div>



<div class="viewcode-block" id="project_point_on_line">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.project_point_on_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">project_point_on_line</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Edge</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a point and a line, returns the projection of the point on the line</span>

<span class="sd">    Args:</span>
<span class="sd">        point (Vertex): Input point.</span>
<span class="sd">        line (Edge): Input line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Vertex: Projection of the point on the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">line</span>

    <span class="n">av</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">a</span>
    <span class="n">ab</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">av</span> <span class="o">*</span> <span class="n">ab</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ab</span> <span class="o">*</span> <span class="n">ab</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">ab</span> <span class="o">*</span> <span class="n">t</span></div>



<div class="viewcode-block" id="Vertex">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Vertex">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Vertex</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A 3D vertex.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">Types</span><span class="o">.</span><span class="n">VERTEX</span>
        <span class="n">common_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphics_object</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Vertex(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<div class="viewcode-block" id="Vertex.copy">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Vertex.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vertex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vertex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Vertex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the coordinates as a tuple.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Homogeneous coordinates as a numpy array.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<div class="viewcode-block" id="Vertex.v_tuple">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Vertex.v_tuple">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">v_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the vertex as a tuple.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></div>


<div class="viewcode-block" id="Vertex.below">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Vertex.below">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">below</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is for 2D points only</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Vertex): Other vertex.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this vertex is below the other vertex, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="Vertex.above">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Vertex.above">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">above</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is for 2D points only</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Vertex): Other vertex.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if this vertex is above the other vertex, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">res</span></div>
</div>



<div class="viewcode-block" id="Edge">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.Edge">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Edge</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A 2D edge.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Vertex</span><span class="p">],</span> <span class="n">end_point</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Point</span><span class="p">,</span> <span class="n">Vertex</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="o">*</span><span class="n">start_point</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_point</span><span class="p">,</span> <span class="n">Vertex</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start_point</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start point should be a Point or Vertex instance.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_point</span><span class="p">,</span> <span class="n">Point</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="o">*</span><span class="n">end_point</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_point</span><span class="p">,</span> <span class="n">Vertex</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">end_point</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End point should be a Point or Vertex instance.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">Types</span><span class="o">.</span><span class="n">EDGE</span>
        <span class="n">common_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphics_object</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edge(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edge(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">isclose</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;atol&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="ow">and</span> <span class="n">isclose</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;atol&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;atol&quot;</span><span class="p">])</span>
            <span class="ow">and</span> <span class="n">isclose</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;rtol&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;atol&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscript</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">subscript</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">subscript</span><span class="o">.</span><span class="n">stop</span> <span class="p">:</span> <span class="n">subscript</span><span class="o">.</span><span class="n">step</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">subscript</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid subscript.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscript</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">vertices</span><span class="p">[</span><span class="n">subscript</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">subscript</span><span class="o">.</span><span class="n">stop</span> <span class="p">:</span> <span class="n">subscript</span><span class="o">.</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">subscript</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">vertices</span><span class="p">[</span><span class="n">subscript</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Line slope. The slope of the line passing through the start and end points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Line angle. Angle between the line and the x-axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">atan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">inclination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inclination angle. Angle between the line and the x-axis converted to</span>
<span class="sd">        a value between zero and pi.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">%</span> <span class="n">pi</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Length of the line segment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">x1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;x-coordinate of the start point.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">y1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;y-coordinate of the start point.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">x2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;x-coordinate of the end point.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">y2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;y-coordinate of the end point.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">y</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start and end&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">point</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start and end vertices.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Homogeneous coordinates as a numpy array.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">array</span><span class="p">])</span></div>



<div class="viewcode-block" id="rotate_point_3D">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.rotate_point_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotate_point_3D</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Point</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate a 2d point (out of paper) about a 2d line by the given angle.</span>
<span class="sd">    This is used for animating mirror reflections.</span>
<span class="sd">     Args:</span>
<span class="sd">         point (Point): Point to rotate.</span>
<span class="sd">         line (Line): Line to rotate about.</span>
<span class="sd">         angle (float): Angle of rotation in radians.</span>

<span class="sd">     Returns:</span>
<span class="sd">         Point: Rotated point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">..graphics.affine</span><span class="w"> </span><span class="kn">import</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">translation_matrix</span>

    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">line</span>
    <span class="n">line_angle_</span> <span class="o">=</span> <span class="n">line_angle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">translation</span> <span class="o">=</span> <span class="n">translation_matrix</span><span class="p">(</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="p">(</span><span class="o">-</span><span class="n">line_angle_</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">xform</span> <span class="o">=</span> <span class="n">translation</span> <span class="o">@</span> <span class="n">rotation</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">@</span> <span class="n">xform</span>

    <span class="n">y</span> <span class="o">*=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

    <span class="n">inv_translation</span> <span class="o">=</span> <span class="n">translation_matrix</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">inv_rotation</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="p">(</span><span class="n">line_angle_</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">inv_xform</span> <span class="o">=</span> <span class="n">inv_rotation</span> <span class="o">@</span> <span class="n">inv_translation</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">@</span> <span class="n">inv_xform</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="rotate_line_3D">
<a class="viewcode-back" href="../../../simetri.geometry.html#simetri.geometry.geometry.rotate_line_3D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotate_line_3D</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">about</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate a 3d line about a 3d line by the given angle</span>

<span class="sd">    Args:</span>
<span class="sd">        line (Line): Line to rotate.</span>
<span class="sd">        about (Line): Line to rotate about.</span>
<span class="sd">        angle (float): Angle of rotation in radians.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Line: Rotated line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rotate_point_3D</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">about</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">rotate_point_3D</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">about</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">simetri.graphics</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">src</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Fahri Basegmez.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>